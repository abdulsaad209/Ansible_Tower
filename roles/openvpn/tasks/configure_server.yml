---

- name: Copy OpenVPN server config
  copy:
    src: /usr/share/doc/openvpn-2.4.12/sample/sample-config-files/server.conf
    dest: /etc/openvpn/server.conf
    remote_src: yes

- name: Uncomment specific lines in OpenVPN config
  replace:
    path: /etc/openvpn/server.conf
    regexp: '^;?\s*{{ item }}'
    replace: '{{ item }}'
  loop:
    - 'dh dh2048.pem'
    - 'push "redirect-gateway def1 bypass-dhcp"'
    - 'push "dhcp-option DNS 8.8.8.8"'
    - 'push "dhcp-option DNS 8.8.4.4"'
    - 'user nobody'
    - 'group nobody'

- name: Comment out tls-auth line
  replace:
    path: /etc/openvpn/server.conf
    regexp: '^tls-auth ta.key 0'
    replace: '#tls-auth ta.key 0'
