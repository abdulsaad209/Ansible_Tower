---

- name: Copy OpenVPN server config
  copy:
    src: /usr/share/doc/openvpn-2.4.1/sample/sample-config-files/server.conf
    dest: /etc/openvpn/server.conf
    remote_src: yes

- name: Modify server.conf for basic config
  lineinfile:
    path: /etc/openvpn/server.conf
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    state: present
  loop:
    - { regexp: '^;?dh ', line: 'dh dh2048.pem' }
    - { regexp: '^;?push "redirect-gateway', line: 'push "redirect-gateway def1 bypass-dhcp"' }
    - { regexp: '^;?push "dhcp-option DNS 8.8.8.8"', line: 'push "dhcp-option DNS 8.8.8.8"' }
    - { regexp: '^;?push "dhcp-option DNS 8.8.4.4"', line: 'push "dhcp-option DNS 8.8.4.4"' }
    - { regexp: '^;?user nobody', line: 'user nobody' }
    - { regexp: '^;?group nobody', line: 'group nobody' }

- name: Comment out tls-auth line
  replace:
    path: /etc/openvpn/server.conf
    regexp: '^tls-auth ta.key 0'
    replace: '#tls-auth ta.key 0'
